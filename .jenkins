#!/usr/bin/env groovy

// Include this shared CI repository to load script helpers and libraries.
library identifier: 'vapor@1.20.1', retriever: modernSCM([
  $class: 'GitSCMSource',
  remote: 'https://github.com/vapor-ware/ci-shared.git',
  credentialsId: 'vio-bot-gh',
])


pythonPipeline([
  'image': 'docker.io/vaporio/netbox',
  'pythonVersion': '3.7',
  'skipDocs': true,
  'skipLint': true,
  'skipUnitTest': true,
  'skipIntegrationTest': true,
  'skipPrivateRepo': true,
  'skipClair': true,
  'podTemplate': """
apiVersion: v1
kind: Pod
spec:
  imagePullSecrets:
  - name: dockerhub-vaporvecrobot
  containers:
  - name: python
    image: docker.io/vaporio/jenkins-agent-python37:master
    imagePullPolicy: Always
    command:
    - cat
    tty: true
    resources:
      requests:
        memory: 1Gi
        cpu: 500m
  - name: deploy
    image: docker.io/vaporio/deployment-tools:latest
    imagePullPolicy: Always
    command:
    - cat
    tty: true
    resources:
      requests:
        memory: 512Mi
        cpu: 250m
  - name: postgres
    image: postgres:11
    env:
    - name: POSTGRES_USER
      value: postgres
    - name: POSTGRES_PASSWORD
      value: 12345
    resources:
      requests:
        memory: 256Mi
        cpu: 250m
  - name: redis
    image: redis:5
    command:
    - redis-server
    args:
    - --appendonly yes
    - --requirepass 12345
    resources:
      requests:
        memory: 128Mi
        cpu: 250m
  imagePullSecrets:
    - name: dockerhub-vaporvecrobot
""".stripIndent(),
])
