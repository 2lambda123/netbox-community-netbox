{% load helpers %}
{% load log_levels %}
{% load i18n %}
{% load render_table from django_tables2 %}

<div class="htmx-container">
  <p>
    {% if job.started %}
      {% trans "Started" %}: <strong>{{ job.started|isodatetime }}</strong>
    {% elif job.scheduled %}
      {% trans "Scheduled for" %}: <strong>{{ job.scheduled|isodatetime }}</strong>
    {% else %}
      {% trans "Created" %}: <strong>{{ job.created|isodatetime }}</strong>
    {% endif %}
    {% if job.completed %}
      {% trans "Duration" %}: <strong>{{ job.duration }}</strong>
    {% endif %}
    <span id="pending-result-label">{% badge job.get_status_display job.get_status_color %}</span>
  </p>
  {% if job.completed %}
    {% if tests %}
      {# Summary of test methods #}
      <div class="card">
        <h5 class="card-header">{% trans "Test Summary" %}</h5>
        <table class="table table-hover">
          {% for test, data in tests.items %}
            <tr>
              <td class="font-monospace">{{ test }}</td>
              <td class="text-end report-stats">
                <span class="badge text-bg-success">{{ data.success }}</span>
                <span class="badge text-bg-info">{{ data.info }}</span>
                <span class="badge text-bg-warning">{{ data.warning }}</span>
                <span class="badge text-bg-danger">{{ data.failure }}</span>
              </td>
            </tr>
          {% endfor %}
        </table>
      </div>
    {% endif %}

    {% if table %}
    <div class="card">
      <div class="table-responsive" id="object_list">
        <h5 class="card-header">{% trans "Log" %}</h5>

<div class="table-responsive">
  {% with preferences|get_key:"pagination.placement" as paginator_placement %}
    {% if paginator_placement == 'top' or paginator_placement == 'both' %}
      {% include 'inc/paginator.html' with htmx=True table=table paginator=table.paginator page=table.page placement='top' %}
    {% endif %}
    {% render_table table 'inc/table_htmx.html' %}
    {% if paginator_placement != 'top' %}
      {% include 'inc/paginator.html' with htmx=True table=table paginator=table.paginator page=table.page %}
    {% endif %}
  {% endwith %}
</div>

{# Include the updated object count for display elsewhere on the page #}
<div class="d-none" hx-swap-oob="innerHTML:.total-object-count">{{ table.rows|length }}</div>
      </div>
    </div>
    {% endif %}

    {# Script output. Legacy reports will not have this. #}
    {% if 'output' in job.data %}
      <div class="card mb-3">
      <h5 class="card-header">{% trans "Output" %}</h5>
        {% if job.data.output %}
          <pre class="card-body font-monospace">{{ job.data.output }}</pre>
        {% else %}
          <div class="card-body text-muted">{% trans "None" %}</div>
        {% endif %}
      </div>
    {% endif %}

  {% elif job.started %}
    {% include 'extras/inc/result_pending.html' %}
  {% endif %}
</div>
